version: '3.8'

services:
  wordpress:
    # âŒ ê¸°ì¡´: image: wordpress:latest
    # âœ… ECSìš© ë³€ê²½: ë¡œì»¬ì—ì„œ ì»¤ìŠ¤í…€ Dockerfile ë¹Œë“œ (ECSì™€ ë™ì¼í•œ í™˜ê²½)
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: wordpress-local  # âœ… ì´ë¦„ ë³€ê²½: ë¡œì»¬ì„ì„ ëª…ì‹œ
    restart: always
    ports:
      - "8080:80"  # ğŸ”„ ê¸°ì¡´ê³¼ ë™ì¼
    environment:
      # âœ… ECSìš© ë³€ê²½: í™˜ê²½ë³€ìˆ˜ëª…ì„ ECSì™€ í†µì¼ (WORDPRESS_ ì ‘ë‘ì‚¬ ì‚¬ìš©)
      # âŒ ê¸°ì¡´: WORDPRESS_DB_HOST: db
      WORDPRESS_DB_HOST: ${DB_HOST:-db}  # âœ… ê¸°ë³¸ê°’ ì„¤ì •ìœ¼ë¡œ ë¡œì»¬/RDS ëª¨ë‘ ì§€ì›
      WORDPRESS_DB_USER: ${DB_USER}
      WORDPRESS_DB_PASSWORD: ${DB_PASSWORD}
      WORDPRESS_DB_NAME: ${DB_NAME}
      WORDPRESS_DB_PORT: ${DB_PORT:-3306}  # âœ… ECSìš© ì¶”ê°€: í¬íŠ¸ ì„¤ì •
      
      # âœ… ECSìš© ì¶”ê°€: ê°œë°œìš© ë””ë²„ê·¸ ì„¤ì • (ì‹¤ì œ ECSì—ì„œëŠ” ì œê±°ë¨)
      WORDPRESS_DEBUG: 1
      WORDPRESS_CONFIG_EXTRA: |
        define('WP_DEBUG', true);
        define('WP_DEBUG_LOG', true);
        define('WP_DEBUG_DISPLAY', false);
    volumes:
      # ğŸ”„ ê¸°ì¡´ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ ë” êµ¬ì²´ì 
      # âŒ ê¸°ì¡´: - ./wp-config.php:/var/www/html/wp-config.php (Dockerfileì—ì„œ ì²˜ë¦¬)
      - ./wp-content:/var/www/html/wp-content
      - ./uploads.ini:/usr/local/etc/php/conf.d/uploads.ini  # âœ… ECSìš© ì¶”ê°€: ì—…ë¡œë“œ ì œí•œ ì„¤ì •
    depends_on:
      - db
    networks:
      - wordpress-network  # âœ… ECSìš© ì¶”ê°€: ëª…ì‹œì  ë„¤íŠ¸ì›Œí¬ ì„¤ì •

  # ğŸ”„ ê¸°ì¡´ê³¼ ê±°ì˜ ë™ì¼: ë¡œì»¬ ê°œë°œìš© MySQL (ì‹¤ì œ ECSì—ì„œëŠ” RDS ì‚¬ìš©)
  db:
    image: mysql:5.7
    container_name: wordpress-db-local  # âœ… ì´ë¦„ ë³€ê²½: ë¡œì»¬ì„ì„ ëª…ì‹œ
    restart: always
    environment:
      MYSQL_DATABASE: ${DB_NAME}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - wordpress-network  # âœ… ECSìš© ì¶”ê°€: ëª…ì‹œì  ë„¤íŠ¸ì›Œí¬ ì„¤ì •
    ports:
      - "3306:3306"  # âœ… ECSìš© ì¶”ê°€: ì™¸ë¶€ ì ‘ê·¼ìš© (ë””ë²„ê¹…ìš©)

volumes:
  db_data:  # ğŸ”„ ê¸°ì¡´ê³¼ ë™ì¼

# âœ… ECSìš© ì¶”ê°€: ëª…ì‹œì  ë„¤íŠ¸ì›Œí¬ ì •ì˜
networks:
  wordpress-network:
    driver: bridge
